//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//							Headers								//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

#include "./Drivers/Timer/timer.h"
#include "./Drivers/I2C/I2C.h"

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//		CONSTANT AND MACRO DEFINITIONS USING #DEFINE 		 	//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

#define BUFFER_SIZE			10
#define MAGN_ADRESS_SLAVE	0x1D
#define TEST_ADDRESS_W		0x26
#define TEST_ADDRESS_R		0x26



// FXOS8700CQ internal register addresses 
#define FXOS8700CQ_STATUS       0x00 
#define FXOS8700CQ_WHOAMI       0x0D 
#define FXOS8700CQ_XYZ_DATA_CFG 0x0E 
#define FXOS8700CQ_CTRL_REG1    0x2A 
#define FXOS8700CQ_M_CTRL_REG1  0x5B 
#define FXOS8700CQ_M_CTRL_REG2  0x5C 
#define FXOS8700CQ_WHOAMI_VAL   0xC7



#define OUT_X_MSB   0x01
#define OUT_X_LSB   0x02
#define OUT_Y_MSB   0x03
#define OUT_Y_LSB   0x04
#define OUT_Z_MSB   0x05
#define OUT_Z_LSB   0x06

#define FXOS8700CQ_READ_LEN 13
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//			ENUMERATIONS AND STRUCTURES AND TYPEDEFS	  		//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

typedef void (* callbackp) (void);

typedef enum { I2C_ERROR,  I2C_OK} I2C_FAIL;

typedef struct{
    int16_t x;
    int16_t y;
    int16_t z;
}SRAWDATA;

typedef struct{
    SRAWDATA pMagnData;
    SRAWDATA pAccelData;
    I2C_FAIL error;
}read_data;

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//						STATIC VARIABLES						//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

I2C_transcieve_t i2c_com;

uint8_t Buffer[FXOS8700CQ_READ_LEN];

////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
//FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS W FILE LEVEL SCOPE//
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////

static void dummy1(void){};
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//					FUNCTION DEFINITIONS						//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

void App_Init (void){
	I2C_init(I2C_0);
	return;
}

void App_Run (void){
    
    uint8_t slave_address = MAGN_ADRESS_SLAVE;
	i2c_com.data_size = 1;
	i2c_com.data = Buffer;
	i2c_com.callback = dummy1;
	uint8_t register_address = 0x2A;
	i2c_com.data[0] = 0x01;
	I2C_init_transcieve(slave_address,register_address,&i2c_com, false);
	while(I2C_is_transmitting());
	i2c_com.data[0] = 0x00;
	I2C_init_transcieve(slave_address,register_address,&i2c_com, true);
	while(true);
	return;
}

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//					LOCAL FUNCTION DEFINITIONS					//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
