//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//	@file		SysTick.c										//
//	@brief		SysTick driver implementation					//
//	@author		Grupo	4										//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//							Headers								//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

#include "board.h"
#include "MK64F12.h"
#include <stdio.h>
#include "./MC74HC589A.h"
#include "../SPI/SPI.h"
#include "../GPIO/gpio.h"
#include "../Timer/timer.h"
#include "../../board.h"

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//		CONSTANT AND MACRO DEFINITIONS USING #DEFINE 		 	//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//			ENUMERATIONS AND STRUCTURES AND TYPEDEFS	  		//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//						STATIC VARIABLES						//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
//FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS W FILE LEVEL SCOPE//
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//					FUNCTION DEFINITIONS						//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

void MC74HC589A_init(void){
/*****************************************************************
 * @brief Function to initialize the MC74HC589A driver
 ****************************************************************/
	static bool ya_init = false;
	if(!ya_init){
		SPI_init(SPI_0);
		gpioMode(MC74HC589A_LATCH_PIN, OUTPUT);
		gpioMode(MC74HC589A_SHIFT_PIN, OUTPUT);
		gpioWrite(MC74HC589A_LATCH_PIN,HIGH);
		gpioWrite(MC74HC589A_SHIFT_PIN,LOW);
		timerInit();		//Ver si hace falta esto.
		ya_init = true;
	}
    return;
}

void MC74HC589A_latch_data(void){
/*****************************************************************
 * @brief Function called periodically to latch the paralel data 
 *			in its pins
 ****************************************************************/
	gpioToggle(MC74HC589A_LATCH_PIN);
	//timerDelay(1); 							// Esto hay q ver si es realmente necesario.
	gpioToggle(MC74HC589A_LATCH_PIN);
    return;
}

uint8_t MC74HC589A_get_data(void){
/*****************************************************************
 * @brief Function to get the data previosuly latched in the IC.
 * @returns: An 8bit digit with it digit correspondign to a specific
 * 			pin of the latch in the folowing way:
 * 			Answer:		01110101
 * 								0	->	H
 * 								1	->	G
 * 								1	->	F
 * 								1	->	E
 * 								0	->	D
 * 								1	->	C
 * 								0	->	B
 * 								1	->	A
 ****************************************************************/
	uint16_t received;
	uint16_t send = 0;
	gpioToggle(MC74HC589A_SHIFT_PIN);
	uint8_t amount_received = SPI_transcieve(&send,1,&received);
	gpioToggle(MC74HC589A_SHIFT_PIN);
    return received>>8;
}

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//					LOCAL FUNCTION DEFINITIONS					//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
